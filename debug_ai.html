<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIç•Œé¢è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .debug-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button {
            background: #007cba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #005a87;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success { border-color: #28a745; background: #d4edda; }
        .error { border-color: #dc3545; background: #f8d7da; }
        .warning { border-color: #ffc107; background: #fff3cd; }
    </style>
</head>
<body>
    <h1>ğŸ”§ CyberWise AIç•Œé¢è°ƒè¯•å·¥å…·</h1>
    
    <div class="debug-panel">
        <h2>ğŸ“‹ å½“å‰çŠ¶æ€æ£€æŸ¥</h2>
        <button class="button" onclick="checkAIElements()">æ£€æŸ¥AIç•Œé¢å…ƒç´ </button>
        <button class="button" onclick="forceShowAI()">å¼ºåˆ¶æ˜¾ç¤ºAIç•Œé¢</button>
        <button class="button" onclick="testSwitchModes()">æµ‹è¯•æ¨¡å¼åˆ‡æ¢</button>
        <div id="status-result" class="result">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æ£€æŸ¥...</div>
    </div>

    <div class="debug-panel">
        <h2>ğŸ¯ å¿«é€Ÿä¿®å¤</h2>
        <button class="button" onclick="injectAIButtons()">æ³¨å…¥AIæ¨¡å¼æŒ‰é’®</button>
        <button class="button" onclick="fixAIInterface()">ä¿®å¤AIç•Œé¢</button>
        <div id="fix-result" class="result">ä¿®å¤ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
    </div>

    <div class="debug-panel">
        <h2>ğŸ”— å¿«é€Ÿè·³è½¬</h2>
        <button class="button" onclick="goToMainDashboard()">è·³è½¬åˆ°ä¸»Dashboard</button>
        <button class="button" onclick="goToTestPage()">è·³è½¬åˆ°æµ‹è¯•é¡µé¢</button>
    </div>

    <script>
        function checkAIElements() {
            const result = document.getElementById('status-result');
            let report = '=== AIç•Œé¢å…ƒç´ æ£€æŸ¥æŠ¥å‘Š ===\n\n';

            // æ£€æŸ¥AI section
            const aiSection = document.getElementById('ai-section');
            report += `AI Section å…ƒç´ : ${aiSection ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;
            if (aiSection) {
                report += `AI Section æ˜¾ç¤ºçŠ¶æ€: ${aiSection.style.display || 'é»˜è®¤'}\n`;
            }

            // æ£€æŸ¥æ¨¡å¼åˆ‡æ¢æŒ‰é’®
            const chatBtn = document.getElementById('chatModeBtn');
            const writingBtn = document.getElementById('writingModeBtn');
            report += `èŠå¤©æ¨¡å¼æŒ‰é’®: ${chatBtn ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;
            report += `å†™ä½œæ¨¡å¼æŒ‰é’®: ${writingBtn ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;

            // æ£€æŸ¥AIåŒºåŸŸ
            const chatMessages = document.getElementById('aiChatMessages');
            const writingArea = document.getElementById('aiWritingArea');
            report += `èŠå¤©æ¶ˆæ¯åŒºåŸŸ: ${chatMessages ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;
            report += `å†™ä½œåŒºåŸŸ: ${writingArea ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;

            // æ£€æŸ¥ç›¸å…³å‡½æ•°
            report += `\n=== å‡½æ•°æ£€æŸ¥ ===\n`;
            report += `switchAIMode å‡½æ•°: ${typeof window.switchAIMode === 'function' ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;
            report += `showSection å‡½æ•°: ${typeof window.showSection === 'function' ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;

            // æ£€æŸ¥æ˜¯å¦åœ¨iframeä¸­
            report += `\n=== ç¯å¢ƒä¿¡æ¯ ===\n`;
            report += `å½“å‰URL: ${window.location.href}\n`;
            report += `åœ¨iframeä¸­: ${window !== window.top ? 'æ˜¯' : 'å¦'}\n`;

            result.textContent = report;
            result.className = 'result ' + (chatBtn && writingBtn ? 'success' : 'error');
        }

        function forceShowAI() {
            const result = document.getElementById('status-result');
            let report = '=== å¼ºåˆ¶æ˜¾ç¤ºAIç•Œé¢ ===\n\n';

            try {
                // å°è¯•æ˜¾ç¤ºAI section
                const aiSection = document.getElementById('ai-section');
                if (aiSection) {
                    aiSection.style.display = 'block';
                    report += 'âœ… AI section å·²è®¾ç½®ä¸ºæ˜¾ç¤º\n';
                } else {
                    report += 'âŒ æœªæ‰¾åˆ° AI section å…ƒç´ \n';
                }

                // å°è¯•è°ƒç”¨showSectionå‡½æ•°
                if (typeof window.showSection === 'function') {
                    window.showSection('ai');
                    report += 'âœ… å·²è°ƒç”¨ showSection("ai")\n';
                } else {
                    report += 'âŒ showSection å‡½æ•°ä¸å­˜åœ¨\n';
                }

                report += '\nè¯·æ£€æŸ¥ä¸»é¡µé¢æ˜¯å¦æ˜¾ç¤ºAIç•Œé¢';
                result.className = 'result success';
            } catch (error) {
                report += `âŒ é”™è¯¯: ${error.message}`;
                result.className = 'result error';
            }

            result.textContent = report;
        }

        function testSwitchModes() {
            const result = document.getElementById('status-result');
            let report = '=== æ¨¡å¼åˆ‡æ¢æµ‹è¯• ===\n\n';

            try {
                if (typeof window.switchAIMode === 'function') {
                    // æµ‹è¯•åˆ‡æ¢åˆ°å†™ä½œæ¨¡å¼
                    window.switchAIMode('writing');
                    report += 'âœ… å·²åˆ‡æ¢åˆ°å†™ä½œæ¨¡å¼\n';
                    
                    setTimeout(() => {
                        // æµ‹è¯•åˆ‡æ¢å›èŠå¤©æ¨¡å¼
                        window.switchAIMode('chat');
                        report += 'âœ… å·²åˆ‡æ¢å›èŠå¤©æ¨¡å¼\n';
                        result.textContent = report;
                    }, 1000);
                } else {
                    report += 'âŒ switchAIMode å‡½æ•°ä¸å­˜åœ¨\n';
                }
                result.className = 'result success';
            } catch (error) {
                report += `âŒ é”™è¯¯: ${error.message}`;
                result.className = 'result error';
            }

            result.textContent = report;
        }

        function injectAIButtons() {
            const result = document.getElementById('fix-result');
            let report = '=== æ³¨å…¥AIæ¨¡å¼æŒ‰é’® ===\n\n';

            try {
                // æŸ¥æ‰¾AI header
                const aiHeader = document.querySelector('.ai-chat-header');
                if (!aiHeader) {
                    report += 'âŒ æœªæ‰¾åˆ° AI header å…ƒç´ \n';
                    result.textContent = report;
                    result.className = 'result error';
                    return;
                }

                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨æŒ‰é’®
                if (document.getElementById('chatModeBtn')) {
                    report += 'âš ï¸ æ¨¡å¼åˆ‡æ¢æŒ‰é’®å·²å­˜åœ¨\n';
                } else {
                    // åˆ›å»ºæŒ‰é’®å®¹å™¨
                    const buttonContainer = document.createElement('div');
                    buttonContainer.style.cssText = 'margin-top: 15px; display: flex; gap: 10px;';
                    
                    // åˆ›å»ºèŠå¤©æ¨¡å¼æŒ‰é’®
                    const chatBtn = document.createElement('button');
                    chatBtn.id = 'chatModeBtn';
                    chatBtn.innerHTML = 'ğŸ’¬ æ™ºèƒ½é—®ç­”';
                    chatBtn.style.cssText = 'background: linear-gradient(45deg, #00eaff, #0099cc); color: white; border: none; border-radius: 8px; padding: 8px 16px; font-size: 12px; cursor: pointer;';
                    chatBtn.onclick = () => window.switchAIMode && window.switchAIMode('chat');

                    // åˆ›å»ºå†™ä½œæ¨¡å¼æŒ‰é’®
                    const writingBtn = document.createElement('button');
                    writingBtn.id = 'writingModeBtn';
                    writingBtn.innerHTML = 'âœï¸ AI å†™ä½œ';
                    writingBtn.style.cssText = 'background: rgba(255, 255, 255, 0.1); color: #ccc; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; padding: 8px 16px; font-size: 12px; cursor: pointer;';
                    writingBtn.onclick = () => window.switchAIMode && window.switchAIMode('writing');

                    buttonContainer.appendChild(chatBtn);
                    buttonContainer.appendChild(writingBtn);
                    aiHeader.appendChild(buttonContainer);

                    report += 'âœ… å·²æˆåŠŸæ³¨å…¥æ¨¡å¼åˆ‡æ¢æŒ‰é’®\n';
                }

                result.className = 'result success';
            } catch (error) {
                report += `âŒ æ³¨å…¥å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }

            result.textContent = report;
        }

        function fixAIInterface() {
            const result = document.getElementById('fix-result');
            let report = '=== ä¿®å¤AIç•Œé¢ ===\n\n';

            try {
                // å¼ºåˆ¶æ˜¾ç¤ºAI section
                forceShowAI();
                report += 'âœ… å·²å¼ºåˆ¶æ˜¾ç¤ºAIç•Œé¢\n';

                // æ³¨å…¥æŒ‰é’®
                injectAIButtons();
                report += 'âœ… å·²æ£€æŸ¥/æ³¨å…¥æ¨¡å¼æŒ‰é’®\n';

                // å®šä¹‰switchAIModeå‡½æ•°ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
                if (typeof window.switchAIMode !== 'function') {
                    window.switchAIMode = function(mode) {
                        const chatMessages = document.getElementById('aiChatMessages');
                        const writingArea = document.getElementById('aiWritingArea');
                        const chatBtn = document.getElementById('chatModeBtn');
                        const writingBtn = document.getElementById('writingModeBtn');

                        if (mode === 'chat') {
                            if (chatMessages) chatMessages.style.display = 'flex';
                            if (writingArea) writingArea.style.display = 'none';
                            if (chatBtn) {
                                chatBtn.style.background = 'linear-gradient(45deg, #00eaff, #0099cc)';
                                chatBtn.style.color = 'white';
                            }
                            if (writingBtn) {
                                writingBtn.style.background = 'rgba(255, 255, 255, 0.1)';
                                writingBtn.style.color = '#ccc';
                            }
                        } else if (mode === 'writing') {
                            if (chatMessages) chatMessages.style.display = 'none';
                            if (writingArea) writingArea.style.display = 'block';
                            if (writingBtn) {
                                writingBtn.style.background = 'linear-gradient(45deg, #00eaff, #0099cc)';
                                writingBtn.style.color = 'white';
                            }
                            if (chatBtn) {
                                chatBtn.style.background = 'rgba(255, 255, 255, 0.1)';
                                chatBtn.style.color = '#ccc';
                            }
                        }
                    };
                    report += 'âœ… å·²å®šä¹‰ switchAIMode å‡½æ•°\n';
                }

                report += '\nğŸ‰ AIç•Œé¢ä¿®å¤å®Œæˆï¼è¯·è¿”å›ä¸»é¡µé¢æŸ¥çœ‹æ•ˆæœã€‚';
                result.className = 'result success';
            } catch (error) {
                report += `âŒ ä¿®å¤å¤±è´¥: ${error.message}`;
                result.className = 'result error';
            }

            result.textContent = report;
        }

        function goToMainDashboard() {
            if (window.opener) {
                window.opener.focus();
                window.close();
            } else {
                window.location.href = 'templates/dashboard.html';
            }
        }

        function goToTestPage() {
            window.open('test_ai_interface.html', '_blank');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', checkAIElements);
    </script>
</body>
</html> 