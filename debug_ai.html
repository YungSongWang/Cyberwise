<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI界面调试工具</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .debug-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button {
            background: #007cba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #005a87;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success { border-color: #28a745; background: #d4edda; }
        .error { border-color: #dc3545; background: #f8d7da; }
        .warning { border-color: #ffc107; background: #fff3cd; }
    </style>
</head>
<body>
    <h1>🔧 CyberWise AI界面调试工具</h1>
    
    <div class="debug-panel">
        <h2>📋 当前状态检查</h2>
        <button class="button" onclick="checkAIElements()">检查AI界面元素</button>
        <button class="button" onclick="forceShowAI()">强制显示AI界面</button>
        <button class="button" onclick="testSwitchModes()">测试模式切换</button>
        <div id="status-result" class="result">点击上方按钮开始检查...</div>
    </div>

    <div class="debug-panel">
        <h2>🎯 快速修复</h2>
        <button class="button" onclick="injectAIButtons()">注入AI模式按钮</button>
        <button class="button" onclick="fixAIInterface()">修复AI界面</button>
        <div id="fix-result" class="result">修复结果将显示在这里...</div>
    </div>

    <div class="debug-panel">
        <h2>🔗 快速跳转</h2>
        <button class="button" onclick="goToMainDashboard()">跳转到主Dashboard</button>
        <button class="button" onclick="goToTestPage()">跳转到测试页面</button>
    </div>

    <script>
        function checkAIElements() {
            const result = document.getElementById('status-result');
            let report = '=== AI界面元素检查报告 ===\n\n';

            // 检查AI section
            const aiSection = document.getElementById('ai-section');
            report += `AI Section 元素: ${aiSection ? '✅ 存在' : '❌ 不存在'}\n`;
            if (aiSection) {
                report += `AI Section 显示状态: ${aiSection.style.display || '默认'}\n`;
            }

            // 检查模式切换按钮
            const chatBtn = document.getElementById('chatModeBtn');
            const writingBtn = document.getElementById('writingModeBtn');
            report += `聊天模式按钮: ${chatBtn ? '✅ 存在' : '❌ 不存在'}\n`;
            report += `写作模式按钮: ${writingBtn ? '✅ 存在' : '❌ 不存在'}\n`;

            // 检查AI区域
            const chatMessages = document.getElementById('aiChatMessages');
            const writingArea = document.getElementById('aiWritingArea');
            report += `聊天消息区域: ${chatMessages ? '✅ 存在' : '❌ 不存在'}\n`;
            report += `写作区域: ${writingArea ? '✅ 存在' : '❌ 不存在'}\n`;

            // 检查相关函数
            report += `\n=== 函数检查 ===\n`;
            report += `switchAIMode 函数: ${typeof window.switchAIMode === 'function' ? '✅ 存在' : '❌ 不存在'}\n`;
            report += `showSection 函数: ${typeof window.showSection === 'function' ? '✅ 存在' : '❌ 不存在'}\n`;

            // 检查是否在iframe中
            report += `\n=== 环境信息 ===\n`;
            report += `当前URL: ${window.location.href}\n`;
            report += `在iframe中: ${window !== window.top ? '是' : '否'}\n`;

            result.textContent = report;
            result.className = 'result ' + (chatBtn && writingBtn ? 'success' : 'error');
        }

        function forceShowAI() {
            const result = document.getElementById('status-result');
            let report = '=== 强制显示AI界面 ===\n\n';

            try {
                // 尝试显示AI section
                const aiSection = document.getElementById('ai-section');
                if (aiSection) {
                    aiSection.style.display = 'block';
                    report += '✅ AI section 已设置为显示\n';
                } else {
                    report += '❌ 未找到 AI section 元素\n';
                }

                // 尝试调用showSection函数
                if (typeof window.showSection === 'function') {
                    window.showSection('ai');
                    report += '✅ 已调用 showSection("ai")\n';
                } else {
                    report += '❌ showSection 函数不存在\n';
                }

                report += '\n请检查主页面是否显示AI界面';
                result.className = 'result success';
            } catch (error) {
                report += `❌ 错误: ${error.message}`;
                result.className = 'result error';
            }

            result.textContent = report;
        }

        function testSwitchModes() {
            const result = document.getElementById('status-result');
            let report = '=== 模式切换测试 ===\n\n';

            try {
                if (typeof window.switchAIMode === 'function') {
                    // 测试切换到写作模式
                    window.switchAIMode('writing');
                    report += '✅ 已切换到写作模式\n';
                    
                    setTimeout(() => {
                        // 测试切换回聊天模式
                        window.switchAIMode('chat');
                        report += '✅ 已切换回聊天模式\n';
                        result.textContent = report;
                    }, 1000);
                } else {
                    report += '❌ switchAIMode 函数不存在\n';
                }
                result.className = 'result success';
            } catch (error) {
                report += `❌ 错误: ${error.message}`;
                result.className = 'result error';
            }

            result.textContent = report;
        }

        function injectAIButtons() {
            const result = document.getElementById('fix-result');
            let report = '=== 注入AI模式按钮 ===\n\n';

            try {
                // 查找AI header
                const aiHeader = document.querySelector('.ai-chat-header');
                if (!aiHeader) {
                    report += '❌ 未找到 AI header 元素\n';
                    result.textContent = report;
                    result.className = 'result error';
                    return;
                }

                // 检查是否已存在按钮
                if (document.getElementById('chatModeBtn')) {
                    report += '⚠️ 模式切换按钮已存在\n';
                } else {
                    // 创建按钮容器
                    const buttonContainer = document.createElement('div');
                    buttonContainer.style.cssText = 'margin-top: 15px; display: flex; gap: 10px;';
                    
                    // 创建聊天模式按钮
                    const chatBtn = document.createElement('button');
                    chatBtn.id = 'chatModeBtn';
                    chatBtn.innerHTML = '💬 智能问答';
                    chatBtn.style.cssText = 'background: linear-gradient(45deg, #00eaff, #0099cc); color: white; border: none; border-radius: 8px; padding: 8px 16px; font-size: 12px; cursor: pointer;';
                    chatBtn.onclick = () => window.switchAIMode && window.switchAIMode('chat');

                    // 创建写作模式按钮
                    const writingBtn = document.createElement('button');
                    writingBtn.id = 'writingModeBtn';
                    writingBtn.innerHTML = '✍️ AI 写作';
                    writingBtn.style.cssText = 'background: rgba(255, 255, 255, 0.1); color: #ccc; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; padding: 8px 16px; font-size: 12px; cursor: pointer;';
                    writingBtn.onclick = () => window.switchAIMode && window.switchAIMode('writing');

                    buttonContainer.appendChild(chatBtn);
                    buttonContainer.appendChild(writingBtn);
                    aiHeader.appendChild(buttonContainer);

                    report += '✅ 已成功注入模式切换按钮\n';
                }

                result.className = 'result success';
            } catch (error) {
                report += `❌ 注入失败: ${error.message}`;
                result.className = 'result error';
            }

            result.textContent = report;
        }

        function fixAIInterface() {
            const result = document.getElementById('fix-result');
            let report = '=== 修复AI界面 ===\n\n';

            try {
                // 强制显示AI section
                forceShowAI();
                report += '✅ 已强制显示AI界面\n';

                // 注入按钮
                injectAIButtons();
                report += '✅ 已检查/注入模式按钮\n';

                // 定义switchAIMode函数（如果不存在）
                if (typeof window.switchAIMode !== 'function') {
                    window.switchAIMode = function(mode) {
                        const chatMessages = document.getElementById('aiChatMessages');
                        const writingArea = document.getElementById('aiWritingArea');
                        const chatBtn = document.getElementById('chatModeBtn');
                        const writingBtn = document.getElementById('writingModeBtn');

                        if (mode === 'chat') {
                            if (chatMessages) chatMessages.style.display = 'flex';
                            if (writingArea) writingArea.style.display = 'none';
                            if (chatBtn) {
                                chatBtn.style.background = 'linear-gradient(45deg, #00eaff, #0099cc)';
                                chatBtn.style.color = 'white';
                            }
                            if (writingBtn) {
                                writingBtn.style.background = 'rgba(255, 255, 255, 0.1)';
                                writingBtn.style.color = '#ccc';
                            }
                        } else if (mode === 'writing') {
                            if (chatMessages) chatMessages.style.display = 'none';
                            if (writingArea) writingArea.style.display = 'block';
                            if (writingBtn) {
                                writingBtn.style.background = 'linear-gradient(45deg, #00eaff, #0099cc)';
                                writingBtn.style.color = 'white';
                            }
                            if (chatBtn) {
                                chatBtn.style.background = 'rgba(255, 255, 255, 0.1)';
                                chatBtn.style.color = '#ccc';
                            }
                        }
                    };
                    report += '✅ 已定义 switchAIMode 函数\n';
                }

                report += '\n🎉 AI界面修复完成！请返回主页面查看效果。';
                result.className = 'result success';
            } catch (error) {
                report += `❌ 修复失败: ${error.message}`;
                result.className = 'result error';
            }

            result.textContent = report;
        }

        function goToMainDashboard() {
            if (window.opener) {
                window.opener.focus();
                window.close();
            } else {
                window.location.href = 'templates/dashboard.html';
            }
        }

        function goToTestPage() {
            window.open('test_ai_interface.html', '_blank');
        }

        // 页面加载时自动检查
        window.addEventListener('load', checkAIElements);
    </script>
</body>
</html> 