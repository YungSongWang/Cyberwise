<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberWise - 知识库</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="../static/css/style.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>

<body style="margin: 0; display: flex; height: 100vh; background-color: #0f0f0f;" data-page="knowledge">
    <!-- 右上角工具栏 -->
    <div class="top-toolbar">
        <button id="language-btn" class="toolbar-btn" onclick="toggleLanguage()">中文</button>
        <button class="toolbar-btn logout-btn" onclick="logout()">
            <i class="ri-logout-box-line"></i> <span data-lang="logout">Logout</span>
        </button>
    </div>

    <!-- 侧边栏 -->
    <div class="sidebar">
        <div class="logo">
            <i class="ri-brain-line" style="margin-right: 8px;"></i>
            <span data-lang="title">CyberWise</span>
        </div>
        
        <div class="user-info">
            <div>欢迎回来！</div>
            <div id="user-email"></div>
        </div>
        
        <div class="search-box">
            <i class="ri-search-line" style="margin-right: 8px; color: #888;"></i>
            <input type="text" data-lang="searchPlaceholder" placeholder="Search Knowledge Base">
        </div>
        
        <div class="menu">
            <div class="menu-item" onclick="goToDashboard()">
                <i class="ri-dashboard-line"></i>
                <span data-lang="menuStart">Start</span>
            </div>
            
            <div class="menu-item" onclick="goToAI()">
                <i class="ri-robot-line"></i>
                <span data-lang="menuAI">AI Writing</span>
            </div>
            
            <div class="menu-item" onclick="goToNotes()">
                <i class="ri-file-text-line"></i>
                <span data-lang="menuNotes">Notes</span>
            </div>
            
            <div class="menu-item" style="background-color: #2c2c2c; color: #00eaff;">
                <i class="ri-book-open-line"></i>
                <span data-lang="knowledgeBase">Knowledge Base</span>
            </div>
            
            <div class="menu-item" onclick="goToFavorites()">
                <i class="ri-heart-line"></i>
                <span data-lang="menuFavorites">Favorites</span>
            </div>
            
            <div class="menu-item" onclick="goToCommunity()">
                <i class="ri-team-line"></i>
                <span data-lang="menuCommunity">Community</span>
            </div>
        </div>
        
        <div class="menu-expand">
            <span data-lang="knowledgeBase">Knowledge Base</span>
        </div>
        
        <div class="logout" onclick="logout()">
            <i class="ri-logout-box-line"></i>
            <span data-lang="logOut">Log Out</span>
        </div>
    </div>
    
    <!-- 主要内容区域 -->
    <div class="main">
        <div id="knowledge-search-container">
            <!-- 知识库搜索界面将在这里动态生成 -->
            <div style="text-align: center; padding: 60px 20px; color: #888;">
                <i class="ri-loader-4-line" style="font-size: 48px; animation: spin 1s linear infinite;"></i>
                <h3>正在加载知识库...</h3>
                <p>请稍候，正在初始化数据...</p>
            </div>
        </div>
    </div>

    <!-- 脚本文件 -->
    <script src="../static/js/firebase-init.js"></script>
    <script src="../static/js/language.js"></script>
    <script src="../static/js/knowledge_base.js"></script>
    
    <script>
        // 页面导航函数
        function goToDashboard() {
            window.location.href = window.location.origin + '/templates/dashboard.html';
        }
        
        function goToAI() {
            // TODO: 创建AI页面
            alert('AI Writing功能即将上线！');
        }
        
        function goToNotes() {
            // TODO: 创建笔记页面
            alert('Notes功能即将上线！');
        }
        
        function goToFavorites() {
            // TODO: 创建收藏页面
            alert('Favorites功能即将上线！');
        }
        
        function goToCommunity() {
            // TODO: 创建社区页面
            alert('Community功能即将上线！');
        }
        
        // 退出登录
        function logout() {
            if (confirm(getText('confirmLogout') || '确定要退出登录吗？')) {
                firebase.auth().signOut().then(() => {
                    alert(getText('loggedOut') || '已退出登录');
                    window.location.href = window.location.origin + '/templates/login.html';
                }).catch(error => {
                    console.error('退出登录失败:', error);
                    alert('退出登录失败，请重试');
                });
            }
        }
        
        // 检查用户登录状态
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                console.log('用户已登录:', user);
                document.getElementById('user-email').textContent = user.email;
            } else {
                console.log('用户未登录，重定向到登录页面');
                alert(getText('notLoggedIn') || '请先登录');
                window.location.href = window.location.origin + '/templates/login.html';
            }
        });
        
        // 旋转动画
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html> 